
-- T8
	select 
	distinct tisd.vin,
	tc.config_name,
	x.拥车车型
	from vehicle.tt_invoice_statistics_dms tisd   -- 与发票表关联
	left join(
		select a.member_id
		,a.vin_code
		,a.bind_date
		,b.model_name 拥车车型
		,row_number()over(partition by a.vin_code order by a.bind_date desc) rk 
		from volvo_cms.vehicle_bind_relation a
		left join basic_data.tm_model b on a.series_code =b.model_code
		where a.deleted = 0
		and a.is_bind=1
		)x on x.vin_code=tisd.vin 
	left join basic_data.tm_config tc on tisd.config_code =tc.config_code  and tisd.config_id =tc.id
--	where tisd.vin in ()


-- T8
select 
distinct tisd.vin,
x.distinct_id
from ods_vehi.ods_vehi_tt_invoice_statistics_dms_cur tisd   -- 与发票表关联
global left join	
	(select distinct a.cust_id as id,
	a.vin_code
	from (
--		 取最近一次绑车时间
		 select
		 r.member_id,
		 m.cust_id,
		 r.bind_date,
		 r.vin_code,
		 m.member_phone,
		 row_number() over(partition by r.vin_code order by r.bind_date desc) rk
		 from ods_vocm.ods_vocm_vehicle_bind_relation_cur r
		 left join ods_memb.ods_memb_tc_member_info_cur m on toString(r.member_id) =toString(m.id) 
		 where r.deleted = 0
		 and r.is_bind = 1   -- 绑车
		 and r.member_id is not null 
		 and r.member_id <>''
		 and m.member_phone<>'*'
		 and m.member_phone is not null 
		 Settings allow_experimental_window_functions = 1
		 )a 
	where a.rk=1
	)xx on xx.vin_code=tisd.vin
left join (
	select 
	distinct distinct_id
	from ods_rawd.ods_rawd_events_d_di a
	where 1=1
	and event='Page_entry'
	and length(distinct_id)<9 
	and page_title='沃尔沃首款纯电豪华MPV'
	and date>'2023-08-01'
)x on toString(x.distinct_id) =toString(xx.id) 
where tisd.vin in ()

-- 是否浏览EM90
	select 
	distinct m.id
	from ods_rawd.ods_rawd_events_d_di a
	left join ods_memb.ods_memb_tc_member_info_cur m on toString(m.cust_id)=toString(a.distinct_id)  
	where 1=1
	and event='Page_entry'
	and length(distinct_id)<9 
	and page_title='沃尔沃首款纯电豪华MPV'
	and date>'2023-08-01'
	and m.id in ('3014820',
'3015036',
'3018468',
'3020265',
'3020766',
'3024695',
'3034054',
'3040994',
'3042212',
'3042378',
'3043532',
'3047959',
'3048571',
'3050529',
'3051386',
'3055182',
'3057542',
'3057996',
'3066646',
'3069054',
'3070569',
'3076672',
'3077329',
'3081573',
'3082108',
'3092930',
'3100400',
'3101035',
'3102573',
'3109228',
'3110332',
'3112037',
'3117488',
'3122246',
'3122449',
'3123889',
'3131697',
'3136115',
'3140089',
'3150061',
'3152007',
'3152252',
'3165261',
'3177594',
'3183201',
'3183202',
'3187718',
'3192891',
'3199866',
'3212823',
'3214557',
'3214713',
'3231269',
'3231463',
'3245818',
'3249150',
'3251339',
'3265787',
'3274289',
'3284135',
'3292125',
'3307627',
'3311366',
'3329578',
'3349169',
'3357485',
'3357822',
'3359605',
'3360596',
'3370882',
'3372047',
'3372996',
'3380237',
'3384569',
'3385155',
'3393423',
'3397847',
'3398578',
'3407771',
'3422252',
'3431836',
'3434572',
'3442322',
'3449788',
'3455732',
'3457200',
'3461678',
'3463761',
'3467336',
'3467395',
'3470249',
'3472958',
'3475431',
'3475549',
'3484281',
'3485120',
'3487858',
'3498584',
'3500628',
'3506250',
'3506293',
'3509293',
'3513383',
'3516020',
'3527509',
'3529811',
'3532825',
'3535867',
'3541915',
'3552171',
'3555959',
'3556414',
'3557378',
'3561548',
'3561555',
'3564393',
'3565420',
'3578169',
'3584294',
'3585702',
'3591096',
'3591868',
'3594456',
'3601819',
'3601841',
'3606210',
'3610834',
'3615102',
'3618306',
'3621776',
'3623188',
'3623257',
'3625036',
'3628276',
'3631752',
'3635580',
'3638008',
'3638914',
'3639585',
'3639685',
'3642961',
'3664920',
'3671403',
'3672720',
'3673829',
'3674292',
'3676245',
'3676773',
'3677461',
'3678038',
'3678925',
'3687485',
'3697492',
'3699562',
'3701288',
'3705552',
'3706332',
'3712681',
'3714985',
'3715088',
'3719856',
'3740505',
'3741728',
'3742326',
'3742552',
'3743910',
'3757922',
'3762552',
'3768294',
'3777333',
'3784939',
'3785218',
'3789760',
'3796101',
'3797777',
'3797919',
'3801227',
'3802310',
'3806724',
'3807875',
'3814559',
'3815307',
'3822089',
'3829183',
'3831581',
'3838309',
'3839251',
'3840427',
'3840460',
'3840929',
'3857478',
'3872322',
'3893193',
'3894150',
'3896455',
'3912200',
'3940470',
'3955579',
'4043222',
'4064023',
'4076047',
'4084641',
'4088603',
'4089963',
'4092740',
'4092954',
'4092961',
'4093371',
'4106117',
'4126645',
'4127954',
'4138794',
'4141652',
'4142097',
'4143225',
'4147110',
'4158460',
'4159570',
'4168682',
'4170868',
'4172246',
'4178801',
'4180651',
'4185121',
'4189686',
'4192723',
'4202442',
'4213949',
'4217501',
'4221157',
'4222051',
'4222087',
'4223730',
'4229033',
'4231373',
'4233504',
'4233667',
'4235213',
'4239489',
'4239659',
'4239915',
'4240436',
'4241534',
'4242542',
'4244179',
'4249258',
'4251366',
'4252851',
'4254884',
'4258683',
'4259333',
'4263107',
'4263974',
'4264535',
'4268620',
'4268725',
'4269138',
'4272241',
'4272848',
'4275322',
'4275933',
'4277029',
'4277472',
'4280468',
'4285178',
'4285255',
'4294744',
'4294953',
'4300436',
'4300949',
'4311270',
'4313295',
'4317419',
'4319570',
'4319723',
'4320090',
'4321930',
'4322942',
'4323346',
'4325499',
'4328721',
'4328775',
'4338271',
'4341552',
'4372714',
'4375251',
'4376237',
'4384261',
'4384331',
'4386762',
'4391059',
'4391577',
'4392619',
'4393743',
'4425852',
'4429556',
'4433222',
'4433399',
'4438847',
'4441765',
'4444691',
'4454836',
'4456314',
'4459798',
'4473277',
'4522919',
'4523287',
'4523832',
'4526871',
'4528591',
'4540069',
'4540695',
'4548333',
'4552963',
'4558799',
'4563060',
'4563537',
'4566257',
'4567701',
'4572629',
'4577316',
'4578836',
'4581533',
'4583559',
'4585335',
'4592442',
'4597353',
'4602195',
'4607742',
'4609421',
'4615072',
'4618065',
'4620091',
'4624713',
'4629426',
'4630944',
'4633783',
'4641102',
'4646600',
'4648310',
'4658183',
'4664904',
'4682246',
'4719602',
'4719828',
'4722716',
'4723407',
'4724180',
'4726008',
'4729104',
'4729565',
'4736674',
'4737777',
'4737880',
'4739409',
'4740839',
'4744395',
'4752248',
'4758787',
'4762884',
'4764203',
'4767262',
'4767301',
'4777311',
'4778019',
'4779640',
'4783417',
'4785244',
'4785741',
'4806564',
'4806858',
'4810985',
'4811133',
'4814423',
'4818174',
'4818182',
'5248582',
'5250268',
'5253543',
'5257676',
'5262055',
'5264007',
'5271043',
'5272243',
'5272696',
'5273540',
'5276236',
'5276784',
'5280017',
'5280568',
'5280723',
'5281493',
'5285386',
'5286665',
'5291947',
'5292221',
'5294508',
'5295358',
'5296861',
'5301614',
'5308065',
'5329992',
'5330805',
'5332265',
'5334802',
'5338451',
'5344842',
'5345840',
'5345882',
'5362640',
'5369608',
'5374577',
'5376260',
'5379805',
'5380915',
'5386586',
'5386633',
'5393620',
'5464556',
'5479830',
'5483483',
'5484564',
'5495928',
'5496875',
'5497247',
'5502944',
'5508033',
'5508291',
'5508664',
'5509054',
'5514084',
'5516409',
'5516692',
'5518284',
'5518382',
'5519304',
'5524127',
'5527158',
'5528102',
'5534308',
'5535396',
'5538067',
'5539649',
'5541947',
'5543177',
'5544657',
'5548015',
'5548283',
'5548734',
'5548745',
'5549291',
'5550781',
'5552180',
'5553857',
'5556835',
'5559434',
'5566850',
'5569329',
'5571539',
'5578509',
'5582332',
'5582584',
'5583114',
'5583487',
'5589965',
'5595053',
'5595502',
'5595505',
'5599658',
'5601854',
'5602029',
'5604243',
'5605115',
'5607751',
'5611680',
'5617286',
'5619038',
'5620008',
'5620104',
'5622995',
'5625750',
'5628292',
'5630058',
'5636193',
'5637181',
'5638698',
'5642082',
'5642409',
'5643597',
'5645339',
'5653462',
'5658149',
'5671889',
'5673347',
'5675642',
'5675648',
'5678271',
'5678593',
'5685080',
'5688130',
'5691164',
'5691908',
'5692083',
'5695308',
'5701378',
'5704342',
'5708496',
'5709896',
'5710265',
'5720174',
'5724337',
'5726075',
'5728607',
'5735219',
'5735868',
'5737869',
'5740848',
'5744842',
'5746148',
'5746963',
'5748503',
'5750838',
'5758232',
'5760316',
'5760586',
'5763186',
'5764201',
'5766491',
'5773470',
'5781260',
'5782882',
'5783985',
'5789556',
'5789811',
'5792346',
'5793883',
'5794299',
'5796123',
'5796171',
'5796675',
'5798380',
'5814795',
'5822609',
'5836305',
'5838723',
'5838780',
'5838975',
'5839927',
'5842004',
'5847428',
'5853678',
'5853752',
'5857590',
'5859105',
'5861168',
'5865314',
'5866142',
'5868893',
'5869683',
'5874971',
'5876308',
'5877740',
'5879034',
'5889331',
'5891347',
'5899489',
'5903782',
'5905646',
'5907462',
'5911070',
'5914200',
'5923224',
'5923639',
'5924041',
'5942429',
'5944709',
'5948086',
'5948377',
'5950332',
'5951280',
'5954915',
'5957924',
'5962755',
'5964125',
'5966024',
'5966670',
'5969631',
'5973421',
'5973599',
'5975137',
'5975603',
'5980038',
'5981314',
'5988353',
'5989997',
'5999035',
'6004883',
'6005355',
'6007590',
'6009547',
'6010549',
'6017987',
'6019080',
'6020588',
'6020857',
'6022589',
'6039774',
'6045274',
'6046820',
'6052482',
'6054704',
'6056753',
'6058827',
'6059586',
'6063057',
'6063626',
'6064044',
'6066023',
'6071513',
'6074359',
'6075440',
'6075827',
'6080291',
'6082968',
'6083309',
'6083507',
'6085398',
'6086448',
'6087309',
'6087465',
'6091787',
'6094494',
'6099923',
'6102696',
'6108131',
'6118250',
'6119108',
'6122073',
'6129439',
'6131275',
'6132612',
'6132939',
'6140323',
'6141701',
'6144761',
'6144900',
'6147777',
'6148819',
'6151352',
'6155488',
'6156851',
'6169130',
'6170437',
'6177657',
'6187940',
'6190352',
'6190380',
'6192681',
'6198568',
'6201374',
'6207036',
'6211088',
'6211789',
'6212261',
'6214311',
'6214797',
'6215871',
'6218908',
'6219351',
'6220154',
'6223754',
'6224005',
'6226392',
'6227430',
'6228787',
'6233319',
'6233947',
'6234843',
'6236426',
'6236746',
'6242571',
'6243358',
'6247382',
'6252604',
'6254809',
'6260922',
'6264195',
'6267789',
'6269920',
'6269922',
'6269961',
'6272303',
'6274190',
'6276195',
'6282708',
'6313907',
'6316758',
'6332316',
'6338728',
'6340752',
'6350183',
'6357910',
'6358153',
'6361259',
'6361601',
'6361884',
'6363955',
'6365513',
'6376299',
'6378876',
'6385103',
'6388006',
'6388227',
'6388448',
'6389311',
'6393892',
'6398008',
'6399600',
'6399777',
'6408465',
'6430053',
'6433174',
'6435561',
'6436676',
'6438056',
'6460385',
'6462156',
'6465655',
'6466919',
'6467610',
'6507615',
'6508106',
'6523593',
'6524175',
'6530654',
'6531249',
'6531607',
'6536709',
'6545284',
'6561888',
'6584550',
'6586102',
'6592587',
'6592879',
'6593606',
'6594749',
'6595160',
'6596158',
'6597615',
'6600323',
'6615740',
'6622772',
'6625225',
'6629527',
'6629553',
'6629719',
'6634244',
'6635279',
'6654185',
'6662327',
'6668622',
'6674448',
'6678746',
'6682996',
'6685821',
'6709493',
'6714629',
'6723722',
'6727062',
'6739703',
'6742376',
'6743388',
'6747028',
'6753428',
'6769566',
'6772168',
'6773374',
'6775268',
'6775314',
'6776102',
'6781100',
'6782171',
'6791402',
'6791792',
'6797289',
'6799858',
'6803217',
'6810157',
'6818338',
'6834387',
'6844079',
'6851636',
'6863817',
'6864030',
'6867929',
'6885063',
'6886665',
'6969543',
'6976998',
'6985795',
'7018641',
'7033106',
'7035752',
'7055447',
'7058706',
'7062129',
'7062689',
'7064034',
'7069019',
'7071956',
'7077923',
'7079699',
'7085374',
'7087259',
'7094302',
'7098403',
'7099477',
'7101125',
'7118809',
'7119646',
'7120797',
'7121677',
'7130656',
'7134903',
'7137012',
'7137354',
'7166914',
'7169533',
'7170721',
'7180785',
'7193698',
'7225158',
'7246734',
'7246890',
'7248423',
'7249257',
'7251567',
'7253899',
'7254426',
'7254570',
'7254741',
'7254944',
'7266614',
'7281465',
'7286496',
'7290350',
'7304593',
'7309563',
'7315599',
'7321834',
'7322109',
'7326322',
'7345369',
'7350357',
'7352525',
'7354135',
'7358275',
'7359479',
'7360823',
'7364866',
'7378098',
'7384013',
'7384372',
'7388395',
'7391643',
'7396479',
'7403422',
'7408686',
'7408958',
'7417503',
'7424147',
'7426474',
'7435704',
'7436605',
'7442158',
'7451765',
'7459432',
'7460477',
'7462782',
'7479764',
'7500879',
'7503915',
'7517251',
'7518343',
'7541112',
'7542523',
'7548017',
'7550820',
'7560682',
'7567033',
'7569230',
'7573298',
'7576595',
'7591640',
'7655619',
'7662166',
'7671060',
'7675480',
'7686348',
'7699869',
'7706090',
'7718524',
'7732833',
'7737200',
'7737253',
'7738159',
'7742268',
'7742351',
'7742715',
'7744499',
'7744610',
'7744622')
