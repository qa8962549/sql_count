SELECT
DISTINCT ta.APPOINTMENT_ID 预约ID,
ttp.CUSTOMER_BUSINESS_ID ,
ta.CREATED_AT 预约时间,
ta.ARRIVAL_DATE 实际到店日期,
ca.active_name 活动名称,
-- ta.one_id 客户ID,
ta.customer_name 姓名,
ta.customer_phone 手机号,
h.大区,
-- h.小区,
ta.OWNER_CODE 经销商,
CASE tad.status
	WHEN 70711001 THEN '待试驾'
    WHEN 70711002 THEN '已试驾' 
    WHEN 70711003 THEN '已取消'
    END 试驾状态,
tad.drive_s_at 试驾开始时间,
tad.drive_e_at 试驾结束时间,
ttp.DRIVE_S_AT 工单表试驾开始时间
FROM cyx_appointment.tt_appointment ta
left join `drive-service`.tt_testdrive_plan ttp on concat(ta.CUSTOMER_BUSINESS_ID,ta.CUSTOMER_PHONE) =concat(ttp.CUSTOMER_BUSINESS_ID,ttp.MOBILE) 
LEFT JOIN dictionary.tc_code tc ON tc.CODE_ID = ta.IS_ARRIVED
LEFT JOIN cyx_appointment.tt_appointment_drive tad ON tad.APPOINTMENT_ID = ta.APPOINTMENT_ID 
LEFT JOIN cyxdms_retail.tt_sales_orders tso ON tso.CUSTOMER_BUSINESS_ID = ta.CUSTOMER_BUSINESS_ID
LEFT JOIN activity.cms_active ca ON ca.uid = ta.CHANNEL_ID 
LEFT JOIN dictionary.tc_code tc1 ON tc1.CODE_ID = tso.SO_STATUS
LEFT JOIN (
    select 
        DISTINCT
        tm.COMPANY_CODE,
        tg2.ORG_NAME 大区,
        tg1.ORG_NAME 小区
    from organization.tm_company tm
    inner JOIN organization.tr_org tr1 ON tr1.org_id = tm.org_id
    inner JOIN organization.tm_org tg1 ON tg1.id = tr1.parent_org_id and tg1.ORG_TYPE = 15061007
    inner JOIN organization.tr_org tr2 ON tr2.org_id = tr1.parent_org_id
    inner JOIN organization.tm_org tg2 ON tg2.id = tr2.parent_org_id and tg2.ORG_TYPE = 15061005 
    where tm.IS_DELETED = 0 AND tm.COMPANY_TYPE = 15061003 
    ORDER BY tm.COMPANY_CODE ASC) h on h.COMPANY_CODE = ta.owner_code
WHERE ta.CREATED_AT >= '2022-10-01'
AND ta.CREATED_AT <= '2023-03-31 23:59:59'
AND ta.APPOINTMENT_TYPE = 70691002     -- 预约试乘试驾
-- and tad.status in ('70711001','70711002')
AND ta.DATA_SOURCE = 'C'   -- 数据来源B端C端
and (ca.active_name like '%2022年Q4%' or ca.active_name like '%2023年Q1%')
-- and ca.active_code in ('IBDMDECHBJHHDXCX2022VCCN','IBDMDECHBJHHDAPP2022VCCN')
and ta.customer_phone in ('18701829695',
'18571580334',
'18510005616',
'13641310205',
'15118719008',
'13761145800',
'13006327584',
'13705517885',
'13976868163',
'13401186797',
'13910977656',
'13804144945',
'13451899005',
'18000219949',
'13812685563',
'16621031398',
'18616777824',
'18964402097',
'13020659168',
'18255666088',
'17718372226',
'13806081310',
'15908680040',
'19952990855',
'15070787166',
'15510603920',
'17351013300',
'18862335237',
'15030097369',
'17308949938',
'13941784840',
'15662626000',
'15010807573',
'15236445689',
'18052005959',
'13823214544',
'13247675803',
'18940304213',
'18096626363',
'13567199746',
'13153033311',
'18607175465',
'13956077859',
'15868155038',
'18222787807',
'13709069737',
'17352812918',
'19802548379',
'15206227090',
'18631382302',
'13607006008',
'15039730726',
'19983047211',
'15713173684',
'18292866463',
'16621032185',
'17705173028',
'18876477666',
'18375728589',
'18867328605',
'17805054097',
'18917596080',
'15805980730',
'15898453331',
'13575620315',
'18410979661',
'18586022240',
'13571786848',
'18707048368',
'18510995766',
'18591059234',
'13581995335',
'18274333338',
'13969767027',
'18889535240',
'18981796399',
'13305303250',
'18605486273',
'18961066000',
'15196441230',
'15069012959',
'18289351237',
'18114481506',
'18725878993',
'13022343620',
'18164070051',
'13686543091',
'13775982655',
'18811913604',
'18874403155',
'17315106353',
'13422680505',
'15698087107',
'19398136650',
'17791642503',
'18237962660',
'13776650409',
'13920906101',
'15179887673',
'13574268079',
'13979375766',
'15667882626',
'13572362762',
'15943604370',
'13945663679',
'15675891694',
'13804342829',
'15860356063',
'17690143108',
'13607925809',
'18151551879',
'15527172123',
'18705310199',
'15298000025',
'18897975656',
'15306593172',
'15618490072',
'18342909269',
'13732928348',
'18512111332',
'13810067938',
'18668953121',
'13953455999',
'13370526053',
'13385410696',
'13869127040',
'13708927200',
'18921231218',
'15221753601',
'13805901779',
'15860590616',
'17625501061',
'13505998000',
'13921121693',
'13816456492',
'15275612267',
'13902887816',
'17317351883',
'15169889082',
'15905960200',
'13863503636',
'18704623175',
'17772457214',
'18678622121',
'18668969516',
'18103131118',
'13709381670',
'13504701659',
'15201361316',
'18840874870',
'17351284810',
'15922003366',
'15165845630',
'15270701056',
'15286423610',
'15665705333',
'13321967898',
'18869576078',
'15921593667',
'15973788568',
'15526391561',
'16606110809',
'18661755717',
'14780023223',
'18149224298',
'13383335681',
'13288917791',
'18616505970',
'13521390660',
'18483689959',
'18258218331',
'13805318085',
'15870966989',
'13523730347',
'13661239694',
'18763919777',
'13583168181',
'13671639659',
'13603684925',
'15877661862',
'13946110443',
'18231636788',
'15771083456',
'13911360572',
'15931792358',
'18601682457',
'18205323752',
'18668922553',
'18520868269',
'18290802751',
'18093384963',
'15093663899',
'13045096770',
'13358114136',
'15179024696',
'15797726705',
'15604316869',
'13893164263',
'18359937336',
'18615552085',
'13908200008',
'13015512021',
'18954158866',
'15982317726',
'18181849852',
'13885133066',
'13975827517',
'17789612930',
'13255038646',
'13780549184',
'13661420961',
'18752035966',
'13701019391',
'13386062767',
'18621627627',
'15073905590',
'18861356290',
'13489497042',
'15091933976',
'13726285204',
'18358132786',
'13932428602',
'13771122088',
'13636992911',
'18959933033',
'15010172430',
'13817826593',
'15099085358',
'13812075151',
'13905812186',
'13905911159',
'13581610756',
'13588043507',
'18187586203',
'15088719370',
'13606210590',
'18511694868',
'15988835872',
'17765634704',
'13594290383',
'13540738530',
'15641190603',
'13830445188',
'18526446880',
'13112969989',
'13817269173',
'13467519111',
'13850720668',
'15170762777',
'15995236337',
'13916720847',
'13317523366',
'18758140475',
'18261688250',
'15906870388',
'18678181799',
'18360937573',
'13330111723',
'13617431814',
'15065412455',
'13870460720',
'18789559995',
'15106537999',
'13054025870',
'13771010620',
'13691672002',
'13869836616',
'18766217917',
'17716124836',
'13714660212',
'13874294835',
'17792086693',
'18678777297',
'13918422987',
'15079593260',
'18390235327',
'18328430193',
'18858831588',
'18965512751',
'13883293973',
'15154501161',
'13867786185',
'13637576848',
'13407498811',
'18661722915',
'13501948071',
'13938664521',
'15021613482',
'15041633999',
'15653896931',
'19117506706',
'13810086159',
'13959312037',
'13686990688',
'18759941082',
'13564729535',
'17772041131',
'18970923171',
'13918277424',
'13264405888',
'18769788527',
'15653456619',
'15900488167',
'13952067197',
'13916091925',
'15250170822',
'18800755070',
'17741163977',
'15802581260',
'18600698268',
'13506546208',
'13546532597',
'13350652125',
'13019081285',
'13918052033',
'19905050360',
'13588870893',
'17720700667',
'15873782478',
'17628292720',
'13708410549',
'18156345596',
'18627005089',
'18764048609',
'17606478800',
'13995834860',
'18930135929',
'13955143595',
'15880896938',
'15659806350',
'18651605011',
'13621733400',
'13467125555',
'18501611125',
'18917872100',
'15990195698',
'15959985367',
'13706606620',
'18883183756',
'18166098309',
'13943280416',
'15367491565',
'13928498831',
'13176403778',
'15806006875',
'15707971419',
'13806150307',
'13830805528',
'13654020472',
'13857196930',
'13812737028',
'18113585783',
'18990312326',
'15880209795',
'18005541988',
'15575821972',
'13616955927',
'18622310265',
'13998042167',
'18956007725',
'13575790338',
'18615267512',
'18650651921',
'13626406677',
'17616661137',
'18653187992',
'13003084679',
'15552275161',
'13134232577',
'15820860921',
'15979812625',
'15823366480',
'18908312280',
'18164267633',
'18501762405',
'18954586885',
'13954108259',
'13917852033',
'18130229116',
'15377984618',
'18704396508',
'13065088222',
'13154306085',
'15618678168',
'18005221892',
'15587373397',
'16607334339',
'17562617069',
'19905128227',
'15562625685',
'18601045805',
'15966334038',
'15863680808',
'18608028811',
'13909826182',
'18610278137',
'18578991129',
'18910886901',
'18948169889',
'19205753289',
'18351075297',
'18259330280',
'15602126886',
'15298402901',
'13823514100',
'17355867012',
'15083580001',
'18870552266',
'13970786528',
'18392144855',
'15694138311',
'15997523662',
'18143092205',
'13920282680',
'18124160360',
'15063369319',
'15396569879',
'13888836913',
'15001860800',
'18221923711',
'13102543028',
'15688473687',
'18823865270',
'13675840572',
'15857100153',
'13970891106',
'13210506261',
'15604341703',
'19879875501',
'18040054080',
'15201565879',
'13949407987',
'18314688686',
'13879723316',
'18738775880',
'18925666089',
'13563803536',
'18366716676',
'16631059975',
'13771909170',
'13771921291',
'18695672003',
'18921877779',
'13589798533',
'13952002309',
'15007399529',
'13818678711',
'13761990818',
'17721173252',
'13122023842',
'13941008305',
'19982823198',
'13559513659',
'17783628795',
'15662661680',
'17788661935',
'18249550125',
'13734590226',
'18653111195',
'18705174874',
'15980811643',
'15151882876',
'18171263005',
'13630975523',
'13870695171',
'18926660068',
'13668761860',
'18956011386',
'13865202266',
'13733293808',
'13803826989',
'13920355010',
'13576199535',
'13657358308',
'15895233208',
'15629194178',
'15820487648',
'15243609800',
'13333273965',
'13364262626',
'13607425888',
'15150587282',
'13576026488',
'15865431616',
'18805432789',
'18930664235',
'13629265195',
'13044611115',
'13936988515',
'15552530661',
'15726292752',
'13870734168',
'15900890294',
'18767159293',
'17355199394',
'13616103139',
'17855136819',
'13705638355',
'13793766011',
'18759585207',
'13813927297',
'18968075678',
'18691189989',
'15118642324')
order by ta.CREATED_AT


# 试驾工单表，用户是否试驾数据
select
*
from `drive-service`.tt_testdrive_plan p      -- 试驾工单表（只要数据存在，那么就算这个人试驾了。）
where 1=1
and p.DRIVE_S_AT >= '2022-10-01'    -- 试驾开始时间
and p.DRIVE_S_AT <= '2023-3-31 23:59:59'
and p.IS_DELETED = 0
and p.MOBILE in ('18701829695',
'18571580334',
'18510005616',
'13641310205',
'15118719008',
'13761145800',
'13006327584',
'13705517885',
'13976868163',
'13401186797',
'13910977656',
'13804144945',
'13451899005',
'18000219949',
'13812685563',
'16621031398',
'18616777824',
'18964402097',
'13020659168',
'18255666088',
'17718372226',
'13806081310',
'15908680040',
'19952990855',
'15070787166',
'15510603920',
'17351013300',
'18862335237',
'15030097369',
'17308949938',
'13941784840',
'15662626000',
'15010807573',
'15236445689',
'18052005959',
'13823214544',
'13247675803',
'18940304213',
'18096626363',
'13567199746',
'13153033311',
'18607175465',
'13956077859',
'15868155038',
'18222787807',
'13709069737',
'17352812918',
'19802548379',
'15206227090',
'18631382302',
'13607006008',
'15039730726',
'19983047211',
'15713173684',
'18292866463',
'16621032185',
'17705173028',
'18876477666',
'18375728589',
'18867328605',
'17805054097',
'18917596080',
'15805980730',
'15898453331',
'13575620315',
'18410979661',
'18586022240',
'13571786848',
'18707048368',
'18510995766',
'18591059234',
'13581995335',
'18274333338',
'13969767027',
'18889535240',
'18981796399',
'13305303250',
'18605486273',
'18961066000',
'15196441230',
'15069012959',
'18289351237',
'18114481506',
'18725878993',
'13022343620',
'18164070051',
'13686543091',
'13775982655',
'18811913604',
'18874403155',
'17315106353',
'13422680505',
'15698087107',
'19398136650',
'17791642503',
'18237962660',
'13776650409',
'13920906101',
'15179887673',
'13574268079',
'13979375766',
'15667882626',
'13572362762',
'15943604370',
'13945663679',
'15675891694',
'13804342829',
'15860356063',
'17690143108',
'13607925809',
'18151551879',
'15527172123',
'18705310199',
'15298000025',
'18897975656',
'15306593172',
'15618490072',
'18342909269',
'13732928348',
'18512111332',
'13810067938',
'18668953121',
'13953455999',
'13370526053',
'13385410696',
'13869127040',
'13708927200',
'18921231218',
'15221753601',
'13805901779',
'15860590616',
'17625501061',
'13505998000',
'13921121693',
'13816456492',
'15275612267',
'13902887816',
'17317351883',
'15169889082',
'15905960200',
'13863503636',
'18704623175',
'17772457214',
'18678622121',
'18668969516',
'18103131118',
'13709381670',
'13504701659',
'15201361316',
'18840874870',
'17351284810',
'15922003366',
'15165845630',
'15270701056',
'15286423610',
'15665705333',
'13321967898',
'18869576078',
'15921593667',
'15973788568',
'15526391561',
'16606110809',
'18661755717',
'14780023223',
'18149224298',
'13383335681',
'13288917791',
'18616505970',
'13521390660',
'18483689959',
'18258218331',
'13805318085',
'15870966989',
'13523730347',
'13661239694',
'18763919777',
'13583168181',
'13671639659',
'13603684925',
'15877661862',
'13946110443',
'18231636788',
'15771083456',
'13911360572',
'15931792358',
'18601682457',
'18205323752',
'18668922553',
'18520868269',
'18290802751',
'18093384963',
'15093663899',
'13045096770',
'13358114136',
'15179024696',
'15797726705',
'15604316869',
'13893164263',
'18359937336',
'18615552085',
'13908200008',
'13015512021',
'18954158866',
'15982317726',
'18181849852',
'13885133066',
'13975827517',
'17789612930',
'13255038646',
'13780549184',
'13661420961',
'18752035966',
'13701019391',
'13386062767',
'18621627627',
'15073905590',
'18861356290',
'13489497042',
'15091933976',
'13726285204',
'18358132786',
'13932428602',
'13771122088',
'13636992911',
'18959933033',
'15010172430',
'13817826593',
'15099085358',
'13812075151',
'13905812186',
'13905911159',
'13581610756',
'13588043507',
'18187586203',
'15088719370',
'13606210590',
'18511694868',
'15988835872',
'17765634704',
'13594290383',
'13540738530',
'15641190603',
'13830445188',
'18526446880',
'13112969989',
'13817269173',
'13467519111',
'13850720668',
'15170762777',
'15995236337',
'13916720847',
'13317523366',
'18758140475',
'18261688250',
'15906870388',
'18678181799',
'18360937573',
'13330111723',
'13617431814',
'15065412455',
'13870460720',
'18789559995',
'15106537999',
'13054025870',
'13771010620',
'13691672002',
'13869836616',
'18766217917',
'17716124836',
'13714660212',
'13874294835',
'17792086693',
'18678777297',
'13918422987',
'15079593260',
'18390235327',
'18328430193',
'18858831588',
'18965512751',
'13883293973',
'15154501161',
'13867786185',
'13637576848',
'13407498811',
'18661722915',
'13501948071',
'13938664521',
'15021613482',
'15041633999',
'15653896931',
'19117506706',
'13810086159',
'13959312037',
'13686990688',
'18759941082',
'13564729535',
'17772041131',
'18970923171',
'13918277424',
'13264405888',
'18769788527',
'15653456619',
'15900488167',
'13952067197',
'13916091925',
'15250170822',
'18800755070',
'17741163977',
'15802581260',
'18600698268',
'13506546208',
'13546532597',
'13350652125',
'13019081285',
'13918052033',
'19905050360',
'13588870893',
'17720700667',
'15873782478',
'17628292720',
'13708410549',
'18156345596',
'18627005089',
'18764048609',
'17606478800',
'13995834860',
'18930135929',
'13955143595',
'15880896938',
'15659806350',
'18651605011',
'13621733400',
'13467125555',
'18501611125',
'18917872100',
'15990195698',
'15959985367',
'13706606620',
'18883183756',
'18166098309',
'13943280416',
'15367491565',
'13928498831',
'13176403778',
'15806006875',
'15707971419',
'13806150307',
'13830805528',
'13654020472',
'13857196930',
'13812737028',
'18113585783',
'18990312326',
'15880209795',
'18005541988',
'15575821972',
'13616955927',
'18622310265',
'13998042167',
'18956007725',
'13575790338',
'18615267512',
'18650651921',
'13626406677',
'17616661137',
'18653187992',
'13003084679',
'15552275161',
'13134232577',
'15820860921',
'15979812625',
'15823366480',
'18908312280',
'18164267633',
'18501762405',
'18954586885',
'13954108259',
'13917852033',
'18130229116',
'15377984618',
'18704396508',
'13065088222',
'13154306085',
'15618678168',
'18005221892',
'15587373397',
'16607334339',
'17562617069',
'19905128227',
'15562625685',
'18601045805',
'15966334038',
'15863680808',
'18608028811',
'13909826182',
'18610278137',
'18578991129',
'18910886901',
'18948169889',
'19205753289',
'18351075297',
'18259330280',
'15602126886',
'15298402901',
'13823514100',
'17355867012',
'15083580001',
'18870552266',
'13970786528',
'18392144855',
'15694138311',
'15997523662',
'18143092205',
'13920282680',
'18124160360',
'15063369319',
'15396569879',
'13888836913',
'15001860800',
'18221923711',
'13102543028',
'15688473687',
'18823865270',
'13675840572',
'15857100153',
'13970891106',
'13210506261',
'15604341703',
'19879875501',
'18040054080',
'15201565879',
'13949407987',
'18314688686',
'13879723316',
'18738775880',
'18925666089',
'13563803536',
'18366716676',
'16631059975',
'13771909170',
'13771921291',
'18695672003',
'18921877779',
'13589798533',
'13952002309',
'15007399529',
'13818678711',
'13761990818',
'17721173252',
'13122023842',
'13941008305',
'19982823198',
'13559513659',
'17783628795',
'15662661680',
'17788661935',
'18249550125',
'13734590226',
'18653111195',
'18705174874',
'15980811643',
'15151882876',
'18171263005',
'13630975523',
'13870695171',
'18926660068',
'13668761860',
'18956011386',
'13865202266',
'13733293808',
'13803826989',
'13920355010',
'13576199535',
'13657358308',
'15895233208',
'15629194178',
'15820487648',
'15243609800',
'13333273965',
'13364262626',
'13607425888',
'15150587282',
'13576026488',
'15865431616',
'18805432789',
'18930664235',
'13629265195',
'13044611115',
'13936988515',
'15552530661',
'15726292752',
'13870734168',
'15900890294',
'18767159293',
'17355199394',
'13616103139',
'17855136819',
'13705638355',
'13793766011',
'18759585207',
'13813927297',
'18968075678',
'18691189989',
'15118642324')