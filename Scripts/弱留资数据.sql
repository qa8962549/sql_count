手机号	
会员ID	
车型（如是粉丝身份，本字段为空）	
车龄（同E）	
城市	
会员等级


SELECT
m.id,
m.member_name,
m.real_name,
m.member_phone,
t.车型,
--invoice_date,
ROUND(EXTRACT(YEAR FROM AGE(CURRENT_DATE, invoice_date))::numeric, 2) AS 车龄,
ifnull(c1.city_name,IFNULL(c2.city_name,c3.city_name)) 城市,
m.level_id
FROM "member".tc_member_info m
left join
	( 
	--# 车系
	 select v.member_id,v.vin_code,ifnull(m.MODEL_NAME,v.model_name)车型
	 from (
	 select v.MEMBER_ID,v.series_code,m.model_name,v.vin_code
	 ,row_number() over(PARTITION by v.MEMBER_ID order by v.bind_date desc) rk
	 from volvo_cms.vehicle_bind_relation v 
	 left join basic_data.tm_model m on v.series_code=m.MODEL_CODE
	 where v.DELETED=0 
	 ) v 
	 left join vehicle.tm_vehicle t on v.vin_code=t.VIN
	 left join basic_data.tm_model m on t.MODEL_ID=m.ID
	 where v.rk=1
) t on m.id=t.member_id
left join vehicle.tt_invoice_statistics_dms tisd on t.vin_code=tisd.vin 
left join
	(
	 -- 最后绑定经销商城市
	 select a.member_id,c.PROVINCE_NAME region_name,c.city_name city_name,c.COMPANY_CODE,c.COMPANY_NAME_CN 
	 from
	 (
		  select v.member_id,ifnull(d.dealer_code,vv.dealer_code) dealer_code,vv.model_name
		  from
		  (
		    select v.MEMBER_ID,v.VIN
		    ,row_number() over(partition by v.MEMBER_ID order by v.create_time desc) rk
		    from member.tc_member_vehicle v 
		    where v.is_deleted=0 and v.MEMBER_ID is not null
		  ) v
		  left join vehicle.tm_vehicle vv on v.vin =vv.vin and vv.IS_DELETED=0
		  left join vehicle.tt_invoice_statistics_dms d on v.vin=d.vin and d.IS_DELETED=0
		  left join member.tc_member_info m  on v.member_id=m.id
		  where v.rk=1 -- 获取用户最后绑车记录
	 ) a left join organization.tm_company c on c.company_code=a.dealer_code and c.COMPANY_TYPE=15061003
	) c1 on c1.member_id = m.id
	left join (
	 -- 会员表城市
	 select m.id,c.REGION_NAME,c1.region_name city_name
	 from member.tc_member_info m  
	 left join dictionary.tc_region c on m.MEMBER_PROVINCE=c.REGION_ID
	 left join "dictionary".tc_region c1 on m.member_city = c1.REGION_ID
	 where m.IS_DELETED=0 and m.MEMBER_STATUS<>60341003
	) c2 on c2.id= m.id
	left join (
	 -- 收货地址城市
	 select m.id,cc.REGION_NAME,cc1.region_name city_name
	 from member.tc_member_info m 
	 left join member.tc_member_address a on m.id=a.member_id and a.IS_DEFAULT=1 and a.status=0
	 left join dictionary.tc_region cc on a.address_province=cc.REGION_ID
	 left join "dictionary".tc_region cc1 on a.address_city=cc1.REGION_ID
	 where m.IS_DELETED=0 and m.MEMBER_STATUS<>60341003
	 and a.address_city != 'undefined'
	) c3 on c3.id= m.id
where m.id in ('6915767',
'5831738',
'5535033',
'5708496',
'8157665',
'6269961',
'9008881',
'6117103',
'8937357',
'6227466',
'6178934',
'8943189',
'5515575',
'8282840',
'5339657',
'8269354',
'3135679',
'6051334',
'7667841',
'6720668',
'3274916',
'6667933',
'3036813',
'7275628',
'6771054',
'4014350',
'6134588',
'3056076',
'5918996',
'6125111',
'3105715',
'6191334',
'6479404',
'9072708',
'6556797',
'3509293',
'6679522',
'3839251',
'5723733',
'4310582',
'4351088',
'5885657',
'3638784',
'7124596',
'8036901',
'7084001',
'7295608',
'9014299',
'8057294',
'5656774',
'9073071',
'7087938',
'8646966',
'5965625',
'7834458',
'7805823',
'6281753',
'7265785',
'5939254',
'8991433',
'3691974',
'4290469',
'6216972',
'3601847',
'6171072',
'6625238',
'7463722',
'3728027',
'3862870',
'8505143',
'9060512',
'4269852',
'8458281',
'7101928',
'8158595',
'5544393',
'6818649',
'9042756',
'9145699',
'6421145',
'7697626',
'7145069',
'6072906',
'9286644',
'9023850',
'7985393',
'4153558',
'5942801',
'3716819',
'7952360',
'8965023',
'5879034',
'3194900',
'4079386',
'5599120',
'5740839',
'9261182',
'7809176',
'7984397',
'3244433',
'8290295',
'8563296',
'9266755',
'6879936',
'8541302',
'7950457',
'5946508',
'8225542',
'4656027',
'6223543',
'5979578',
'8940577',
'6457193',
'4775659',
'5678069',
'7403966',
'6538493',
'7055447',
'8783321',
'3624483',
'4165617',
'9040562',
'6009506',
'7881258',
'4558799',
'5834070',
'6166562',
'6539246',
'9288002',
'6240142',
'9130133',
'5532839',
'8943554',
'7142301',
'3638327',
'6216814',
'9093968',
'8414030',
'5299610',
'3758731',
'3690918',
'9165421',
'7096252',
'3495199',
'7861301',
'4610163',
'8145839',
'8225081',
'8804278',
'9089433',
'9129929',
'3067450',
'6117392',
'9062812',
'6265959',
'6194080',
'6760597',
'3040947',
'6886846',
'7061668',
'3866212',
'7513351',
'6123871',
'6171494',
'9347529',
'6774877',
'4562855',
'6915767',
'6213038',
'8937449',
'5954187',
'3559646',
'7562873',
'6265959',
'7456317',
'4452785',
'6236426',
'8489730',
'5360542',
'6144796',
'8665395',
'6993530',
'5910993',
'3839251',
'8127738',
'6722242',
'5265861',
'8224591',
'9287819',
'3036591',
'8483660',
'6129202',
'5824796',
'8898354',
'5581337',
'6815131',
'8087327',
'7934095',
'6446555',
'6955110',
'6675476',
'3566082',
'6078371',
'5988658',
'4319285',
'8743296',
'6187236',
'8936330',
'9014954',
'7820646',
'3795197',
'6917126',
'8174942',
'4586465',
'4572454',
'6436676',
'7177844',
'5750261',
'8051213',
'7782238',
'6227466',
'6195532',
'4205601',
'7365341',
'6117103',
'6574488',
'7118801',
'6377537',
'6089638',
'5638703',
'6072906',
'6082968',
'6038875',
'6745624',
'5824873',
'3757922',
'4141652',
'6295382',
'3219259',
'3241551',
'6112896',
'6000564',
'5824700',
'5938779',
'6018506',
'6420557',
'7360780',
'6577230',
'7429637',
'8671416',
'5841503',
'5515857',
'3564009',
'4669955',
'5800768',
'3640706',
'5547084',
'4818721',
'4381427',
'3242295',
'8785305',
'3194900',
'6798475',
'6215373',
'6071406',
'6531240',
'7402454',
'3791347',
'6685316',
'3366199',
'6457193',
'5751130',
'5630616',
'8152070',
'6669226',
'4223730',
'8988390',
'8600106',
'7466923',
'5442323',
'8302605',
'5868893',
'9208649',
'7061668',
'6663445',
'6051334',
'9336090',
'6746883',
'6670026',
'6341221',
'7956893',
'3302797',
'4232361',
'4299199',
'4604925',
'8685039',
'3350184',
'6599881',
'6341615',
'3727952',
'8734341',
'6131891',
'5932041',
'7064916',
'3861799',
'8092775',
'9285763',
'6715045',
'3775688',
'8303328',
'3675910',
'6270532',
'9025490',
'5589938',
'3792993',
'8051213',
'9345051',
'5803815',
'9268969',
'6117392',
'7119376',
'8572216',
'8580107',
'4728538',
'3036813',
'8567608',
'5285864',
'7208857',
'5281259',
'6123179',
'8713958',
'9187878',
'4323092',
'6171072',
'3791347',
'8725782',
'8593762',
'9050786',
'8129949',
'4592674',
'8794984',
'9061839',
'7984397',
'7069811',
'8639642',
'8189859',
'7519885',
'7855273',
'6254651',
'6446171',
'6538493',
'8402911',
'8900653',
'7518132',
'4430943',
'6042865',
'5780780',
'7808458',
'5272696',
'8232231',
'8343666',
'7062112',
'7675290',
'7879563',
'3311617',
'3670883',
'8186782',
'3631987',
'5743410',
'8658119',
'6295072',
'7572266',
'7541608',
'5954187',
'5248582',
'6129469',
'8488794',
'6685821',
'6752015',
'6216848',
'6009668',
'6067007',
'5554807',
'8551490',
'6602911',
'7938132',
'7356775',
'6134588',
'6190645',
'6057651',
'9073071',
'5812011',
'3869011',
'5278004',
'6264492',
'4775659',
'6466931',
'9279863',
'8010625',
'5371506',
'6642646',
'5925412',
'7360810',
'6927819',
'5991083',
'7487977',
'6915767',
'4578853',
'5599120',
'6534952',
'6915767',
'7347378',
'3552171',
'9209318',
'5490192',
'5855607',
'8021169',
'5869937',
'3261422',
'7732871',
'3119596',
'6009035',
'5815898',
'6915767',
'7549878',
'6214797',
'5831738',
'3191557',
'9039524',
'7743832',
'6723722',
'9159851',
'6464756',
'7574543',
'3629702',
'8577350',
'9334087',
'8733165',
'6359193',
'6100327',
'8743296',
'5678526',
'8198655',
'8674751',
'3806787',
'3476185',
'6670323',
'7385598',
'8991778',
'8786277',
'7876851',
'6647069',
'6981489',
'5360542',
'7404875',
'5958662',
'8115446',
'9160162',
'8589671',
'9250729',
'4179964',
'5939254',
'4789235',
'8013432',
'7964484',
'8174942',
'5847428',
'7879084',
'6757816',
'7577159',
'4610163',
'5916179',
'5924041',
'3625008',
'8652312',
'7368114',
'6455617',
'5248350',
'7990038',
'5816428',
'3715708',
'9278045',
'6829523',
'6577230',
'7416180',
'6202117',
'3329578',
'7275628',
'5992887',
'7675290',
'4283898',
'6134588',
'7102806',
'8049376',
'3315138',
'5938779',
'8115446',
'5247443',
'5563103',
'6071406',
'4472767',
'5573651',
'7469090',
'7142301',
'9208649',
'4462129',
'6024280',
'8988390',
'7418840',
'4133152',
'5694446',
'3146458',
'7545432',
'6295173',
'9251682',
'5965001',
'8929503',
'7379449',
'4805237',
'8937235',
'5535033',
'3727430',
'4664904',
'3727430',
'6217376',
'6814112',
'6594969',
'7210981',
'7540987',
'6693738',
'3295143',
'5574872',
'3055677',
'9281055',
'8033862',
'6520683',
'4771537',
'4247144',
'6122925',
'5598555',
'7430031',
'5954187',
'7395707',
'5687041',
'6041304',
'7380414',
'8785305',
'9035918',
'9045944',
'3804173',
'4203423',
'8251422',
'8274377',
'4172818',
'8672823',
'3640498',
'8683551',
'8280480',
'8325004',
'8943554',
'4245791',
'7680094',
'6747159',
'5811388',
'4468216',
'7894134',
'5919032',
'7003380',
'4320658',
'3051386',
'7680786',
'5929517',
'5929517',
'8071028',
'5668810',
'6915767',
'6435600',
'7250772',
'4454680',
'9334879',
'9261448',
'5571505',
'8131080',
'9322005',
'9343186',
'5999214',
'8041686',
'7348544')